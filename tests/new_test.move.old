#[test_only]
module minihub::comprehensive_tests {
    use minihub::minihub::{
        Self,
        JobBoard,
        Job,
        EmployerCap,
        UserProfile,
        EmployerProfile,
        UserRegistry,
        EmployerRegistry,
    };
    use sui::test_scenario::{Self as ts, Scenario};
    use sui::clock::{Self, Clock};
    use std::string::{Self, String};
    
    // ====== Test Adresleri ======
    const ADMIN: address = @0xAD;
    const EMPLOYER1: address = @0xE1;
    const EMPLOYER2: address = @0xE2;
    const CANDIDATE1: address = @0xC1;
    const CANDIDATE2: address = @0xC2;
    const CANDIDATE3: address = @0xC3;
    
    // ====== Yardımcı Fonksiyonlar ======
    
    /// Test için clock objesi oluştur
    fun create_clock(scenario: &mut Scenario): Clock {
        ts::next_tx(scenario, ADMIN);
        let clock = clock::create_for_testing(ts::ctx(scenario));
        clock
    }
    
    /// String oluşturma yardımcısı
    fun utf8(bytes: vector<u8>): String {
        string::utf8(bytes)
    }
    
    /// Test başlatma - JobBoard, UserRegistry, EmployerRegistry oluştur
    fun setup_test(scenario: &mut Scenario) {
        ts::next_tx(scenario, ADMIN);
        minihub::init_for_testing(ts::ctx(scenario));
    }
    
    // ====== Profile Testleri ======
    
    #[test]
    fun test_create_user_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // UserRegistry'yi al
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        // Kullanıcı profili oluştur
        let skills = vector[utf8(b"Rust"), utf8(b"Move"), utf8(b"Blockchain")];
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Ali Yilmaz"),
            utf8(b"Experienced blockchain developer"),
            utf8(b"https://avatar.com/ali.jpg"),
            skills,
            5,
            utf8(b"https://portfolio.com/ali"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // Profili kontrol et
        ts::next_tx(&mut scenario, CANDIDATE1);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        let (addr, name, bio, avatar, skills, exp, portfolio, created, updated) = 
            minihub::get_user_profile_info(&user_profile);
        
        assert!(addr == CANDIDATE1, 0);
        assert!(name == utf8(b"Ali Yilmaz"), 1);
        assert!(bio == utf8(b"Experienced blockchain developer"), 2);
        assert!(exp == 5, 3);
        assert!(created == updated, 4); // İlk oluşturma
        
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_create_employer_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // EmployerRegistry'yi al
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        // İşyeri profili oluştur
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"TechCorp"),
            utf8(b"Leading blockchain company"),
            utf8(b"https://logo.com/techcorp.png"),
            utf8(b"https://techcorp.com"),
            utf8(b"Blockchain Technology"),
            50,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Profili kontrol et
        ts::next_tx(&mut scenario, EMPLOYER1);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let (addr, company_name, desc, logo, website, industry, emp_count, founded, created, updated) = 
            minihub::get_employer_profile_info(&employer_profile);
        
        assert!(addr == EMPLOYER1, 0);
        assert!(company_name == utf8(b"TechCorp"), 1);
        assert!(industry == utf8(b"Blockchain Technology"), 2);
        assert!(emp_count == 50, 3);
        assert!(founded == 2020, 4);
        
        ts::return_shared(employer_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_update_user_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Profil oluştur
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        let skills = vector[utf8(b"Rust")];
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Old Name"),
            utf8(b"Old Bio"),
            utf8(b"old_avatar.jpg"),
            skills,
            3,
            utf8(b"old_portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // Profili güncelle
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_profile = ts::take_shared<UserProfile>(&scenario);
        
        clock::increment_for_testing(&mut clock, 1000); // 1 saniye sonra
        
        let new_skills = vector[utf8(b"Rust"), utf8(b"Move"), utf8(b"Solidity")];
        minihub::update_user_profile(
            &mut user_profile,
            utf8(b"New Name"),
            utf8(b"New Bio"),
            utf8(b"new_avatar.jpg"),
            new_skills,
            5,
            utf8(b"new_portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        let (_, name, bio, _, skills, exp, _, created, updated) = 
            minihub::get_user_profile_info(&user_profile);
        
        assert!(name == utf8(b"New Name"), 0);
        assert!(bio == utf8(b"New Bio"), 1);
        assert!(exp == 5, 2);
        assert!(updated > created, 3); // Güncelleme zamanı farklı olmalı
        
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_update_employer_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Profil oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Old Company"),
            utf8(b"Old Description"),
            utf8(b"old_logo.png"),
            utf8(b"old.com"),
            utf8(b"Old Industry"),
            10,
            2015,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Profili güncelle
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        clock::increment_for_testing(&mut clock, 2000); // 2 saniye sonra
        
        minihub::update_employer_profile(
            &mut employer_profile,
            utf8(b"New Company"),
            utf8(b"New Description"),
            utf8(b"new_logo.png"),
            utf8(b"new.com"),
            utf8(b"New Industry"),
            100,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        let (_, company_name, desc, _, website, industry, emp_count, founded, created, updated) = 
            minihub::get_employer_profile_info(&employer_profile);
        
        assert!(company_name == utf8(b"New Company"), 0);
        assert!(industry == utf8(b"New Industry"), 1);
        assert!(emp_count == 100, 2);
        assert!(founded == 2020, 3);
        assert!(updated > created, 4);
        
        ts::return_shared(employer_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    // ====== İş İlanı Testleri ======
    
    #[test]
    fun test_post_job_with_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Tech Company"),
            utf8(b"We build stuff"),
            utf8(b"logo.png"),
            utf8(b"tech.com"),
            utf8(b"Technology"),
            25,
            2018,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 7 * 24 * 60 * 60 * 1000; // 7 gün sonra
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Senior Move Developer"),
            utf8(b"We need an experienced Move developer"),
            option::some(150000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        assert!(minihub::get_total_jobs(&job_board) == 1, 0);
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // İş ilanını kontrol et
        ts::next_tx(&mut scenario, EMPLOYER1);
        let job = ts::take_shared<Job>(&scenario);
        
        let (employer, employer_profile_id, title, desc, salary, is_active, hired, deadline_check) = 
            minihub::get_job_info(&job);
        
        assert!(employer == EMPLOYER1, 1);
        assert!(title == utf8(b"Senior Move Developer"), 2);
        assert!(option::is_some(&salary), 3);
        assert!(is_active, 4);
        assert!(option::is_none(&hired), 5);
        assert!(deadline_check == deadline, 6);
        
        ts::return_shared(job);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_apply_to_job_with_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // İşveren ve kullanıcı profillerini oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Description"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Candidate Name"),
            utf8(b"Bio"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Move")],
            3,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 7 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Developer"),
            utf8(b"Job description"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Başvuru yap
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"I am very interested in this position"),
            utf8(b"https://cv.com/candidate1.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        assert!(minihub::get_application_count(&job) == 1, 0);
        
        // Başvuruyu kontrol et
        let app = minihub::get_application(&job, CANDIDATE1, 0);
        let (candidate, user_profile_id, job_id, cover, timestamp, cv_url) = 
            minihub::get_application_info(app);
        
        assert!(candidate == CANDIDATE1, 1);
        assert!(cover == utf8(b"I am very interested in this position"), 2);
        assert!(cv_url == utf8(b"https://cv.com/candidate1.pdf"), 3);
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_multiple_applications() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Move Developer"),
            utf8(b"Description"),
            option::some(120000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // 3 aday için profil oluştur ve başvursun
        let candidates = vector[CANDIDATE1, CANDIDATE2, CANDIDATE3];
        let mut i = 0;
        while (i < 3) {
            let candidate = *vector::borrow(&candidates, i);
            
            // Her aday kendi profilini oluşturur
            ts::next_tx(&mut scenario, candidate);
            let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
            
            minihub::create_user_profile(
                &mut user_registry,
                utf8(b"Candidate"),
                utf8(b"Bio"),
                utf8(b"avatar.jpg"),
                vector[utf8(b"Move")],
                2,
                utf8(b"portfolio.com"),
                &clock,
                ts::ctx(&mut scenario)
            );
            
            ts::return_shared(user_registry);
            
            // Hemen başvuru yap (aynı tx içinde değil, sonraki tx'te)
            ts::next_tx(&mut scenario, candidate);
            let mut job = ts::take_shared<Job>(&scenario);
            let user_profile = ts::take_shared<UserProfile>(&scenario);
            
            minihub::apply_to_job(
                &mut job,
                &user_profile,
                utf8(b"Cover letter"),
                utf8(b"cv_url.pdf"),
                &clock,
                ts::ctx(&mut scenario)
            );
            
            ts::return_shared(job);
            ts::return_shared(user_profile);
            i = i + 1;
        };
        
        // Başvuru sayısını kontrol et
        ts::next_tx(&mut scenario, CANDIDATE1);
        let job = ts::take_shared<Job>(&scenario);
        
        assert!(minihub::get_application_count(&job) == 3, 0);
        
        ts::return_shared(job);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_hire_candidate() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Candidate"),
            utf8(b"Bio"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Move")],
            3,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Developer"),
            utf8(b"Description"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Başvuru yap
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"Cover letter"),
            utf8(b"cv.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        
        // İşe al
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job = ts::take_shared<Job>(&scenario);
        let employer_cap = ts::take_from_sender<EmployerCap>(&scenario);
        
        minihub::hire_candidate(
            &mut job,
            &employer_cap,
            CANDIDATE1,
            0,
            ts::ctx(&mut scenario)
        );
        
        assert!(minihub::is_job_filled(&job), 0);
        
        let (_, _, _, _, _, is_active, hired, _) = minihub::get_job_info(&job);
        assert!(!is_active, 1);
        assert!(option::is_some(&hired), 2);
        assert!(*option::borrow(&hired) == CANDIDATE1, 3);
        
        ts::return_shared(job);
        ts::return_to_sender(&scenario, employer_cap);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    #[expected_failure(abort_code = 4)]
    fun test_apply_after_deadline_fails() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Candidate"),
            utf8(b"Bio"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Move")],
            3,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur (kısa deadline)
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 1000; // 1 saniye
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Developer"),
            utf8(b"Description"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Zamanı deadline'dan sonraya al
        clock::increment_for_testing(&mut clock, 2000);
        
        // Başvuru yap (başarısız olmalı)
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"Cover letter"),
            utf8(b"cv.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    #[expected_failure(abort_code = 2)]
    fun test_apply_to_filled_job_fails() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Candidate1"),
            utf8(b"Bio"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Move")],
            3,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Developer"),
            utf8(b"Description"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Candidate1 başvursun
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"Cover letter"),
            utf8(b"cv.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        
        // Candidate1'i işe al
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job = ts::take_shared<Job>(&scenario);
        let employer_cap = ts::take_from_sender<EmployerCap>(&scenario);
        
        minihub::hire_candidate(
            &mut job,
            &employer_cap,
            CANDIDATE1,
            0,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_to_sender(&scenario, employer_cap);
        
        // Candidate1 tekrar başvursun (başarısız olmalı - pozisyon dolu)
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"Cover letter 2"),
            utf8(b"cv2.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    #[expected_failure(abort_code = 1)]
    fun test_update_wrong_user_profile_fails() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // CANDIDATE1 profil oluştur
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Candidate1"),
            utf8(b"Bio"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Move")],
            3,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // CANDIDATE2 güncellemeye çalışsın (başarısız olmalı)
        ts::next_tx(&mut scenario, CANDIDATE2);
        let mut user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::update_user_profile(
            &mut user_profile,
            utf8(b"Hacked Name"),
            utf8(b"Hacked Bio"),
            utf8(b"hacked.jpg"),
            vector[utf8(b"Hacking")],
            10,
            utf8(b"hacker.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    #[expected_failure(abort_code = 1)]
    fun test_post_job_with_wrong_profile_fails() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // EMPLOYER1 profil oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company1"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // EMPLOYER2 başkasının profiliyle ilan vermeye çalışsın
        ts::next_tx(&mut scenario, EMPLOYER2);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 7 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Fake Job"),
            utf8(b"Description"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_registry_counts() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // 3 kullanıcı profili oluştur
        let candidates = vector[CANDIDATE1, CANDIDATE2, CANDIDATE3];
        let mut i = 0;
        while (i < 3) {
            let candidate = *vector::borrow(&candidates, i);
            ts::next_tx(&mut scenario, candidate);
            let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
            
            minihub::create_user_profile(
                &mut user_registry,
                utf8(b"User"),
                utf8(b"Bio"),
                utf8(b"avatar.jpg"),
                vector[utf8(b"Skill")],
                i,
                utf8(b"portfolio.com"),
                &clock,
                ts::ctx(&mut scenario)
            );
            
            ts::return_shared(user_registry);
            i = i + 1;
        };
        
        // 2 işveren profili oluştur
        let employers = vector[EMPLOYER1, EMPLOYER2];
        i = 0;
        while (i < 2) {
            let employer = *vector::borrow(&employers, i);
            ts::next_tx(&mut scenario, employer);
            let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
            
            minihub::create_employer_profile(
                &mut employer_registry,
                utf8(b"Company"),
                utf8(b"Desc"),
                utf8(b"logo.png"),
                utf8(b"site.com"),
                utf8(b"Tech"),
                10,
                2020,
                &clock,
                ts::ctx(&mut scenario)
            );
            
            ts::return_shared(employer_registry);
            i = i + 1;
        };
        
        // Sayıları kontrol et
        ts::next_tx(&mut scenario, ADMIN);
        let user_registry = ts::take_shared<UserRegistry>(&scenario);
        let employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        assert!(minihub::get_total_users(&user_registry) == 3, 0);
        assert!(minihub::get_total_employers(&employer_registry) == 2, 1);
        
        ts::return_shared(user_registry);
        ts::return_shared(employer_registry);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_job_board_tracking() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let mut clock = create_clock(&mut scenario);
        
        // Bir işveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company1"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Aynı işveren 3 iş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Job 1"),
            utf8(b"Desc"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Job 2"),
            utf8(b"Desc"),
            option::none(),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Job 3"),
            utf8(b"Desc"),
            option::some(80000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        assert!(minihub::get_total_jobs(&job_board) == 3, 0);
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    // ====== Yeni Testler - Edge Cases ve Ek Senaryolar ======
    
    #[test]
    fun test_job_without_salary() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Startup Company"),
            utf8(b"Innovative tech startup"),
            utf8(b"logo.png"),
            utf8(b"startup.com"),
            utf8(b"Technology"),
            5,
            2024,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Maaş belirtmeden iş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 14 * 24 * 60 * 60 * 1000; // 14 gün
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Junior Developer"),
            utf8(b"Entry level position"),
            option::none(), // Maaş yok
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // İş ilanını kontrol et
        ts::next_tx(&mut scenario, EMPLOYER1);
        let job = ts::take_shared<Job>(&scenario);
        
        let (_, _, title, _, salary, is_active, _, _) = minihub::get_job_info(&job);
        
        assert!(title == utf8(b"Junior Developer"), 0);
        assert!(option::is_none(&salary), 1); // Maaş yok
        assert!(is_active, 2);
        
        ts::return_shared(job);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_multiple_skills_in_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // Birçok yetenek ile kullanıcı profili oluştur
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        let skills = vector[
            utf8(b"Rust"),
            utf8(b"Move"),
            utf8(b"TypeScript"),
            utf8(b"React"),
            utf8(b"Blockchain"),
            utf8(b"Smart Contracts"),
            utf8(b"Web3")
        ];
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Full Stack Developer"),
            utf8(b"Expert in blockchain and web development"),
            utf8(b"avatar.jpg"),
            skills,
            7,
            utf8(b"portfolio.dev"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // Profili kontrol et
        ts::next_tx(&mut scenario, CANDIDATE1);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        let (_, name, _, _, profile_skills, exp, _, _, _) = 
            minihub::get_user_profile_info(&user_profile);
        
        assert!(name == utf8(b"Full Stack Developer"), 0);
        assert!(exp == 7, 1);
        assert!(vector::length(&profile_skills) == 7, 2);
        
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_get_application_details() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Tech Corp"),
            utf8(b"Tech company"),
            utf8(b"logo.png"),
            utf8(b"techcorp.com"),
            utf8(b"Tech"),
            50,
            2015,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Alice Johnson"),
            utf8(b"Senior Developer"),
            utf8(b"alice.jpg"),
            vector[utf8(b"Rust"), utf8(b"Move")],
            5,
            utf8(b"alice.dev"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Rust Engineer"),
            utf8(b"Senior position"),
            option::some(180000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Başvuru yap
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        let cover_msg = utf8(b"I have 5 years of Rust experience and would love to join your team!");
        let cv_link = utf8(b"https://alice.dev/cv.pdf");
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            cover_msg,
            cv_link,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        // Başvuru detaylarını kontrol et
        let app = minihub::get_application(&job, CANDIDATE1, 0);
        let (candidate, _, _, cover, _, cv_url) = minihub::get_application_info(app);
        
        assert!(candidate == CANDIDATE1, 0);
        assert!(cover == cover_msg, 1);
        assert!(cv_url == cv_link, 2);
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_job_is_active_after_posting() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Active Company"),
            utf8(b"Always hiring"),
            utf8(b"logo.png"),
            utf8(b"active.com"),
            utf8(b"Recruiting"),
            100,
            2010,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 60 * 24 * 60 * 60 * 1000; // 60 gün
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Always Open Position"),
            utf8(b"We are always looking for talent"),
            option::some(150000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // İlan durumunu kontrol et
        ts::next_tx(&mut scenario, CANDIDATE1);
        let job = ts::take_shared<Job>(&scenario);
        
        let (_, _, _, _, _, is_active, hired, _) = minihub::get_job_info(&job);
        
        assert!(is_active, 0);
        assert!(option::is_none(&hired), 1);
        assert!(!minihub::is_job_filled(&job), 2);
        
        ts::return_shared(job);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_job_becomes_inactive_after_hiring() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Quick Hire Inc"),
            utf8(b"Fast hiring"),
            utf8(b"logo.png"),
            utf8(b"quickhire.com"),
            utf8(b"HR"),
            20,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Quick Candidate"),
            utf8(b"Ready to start"),
            utf8(b"avatar.jpg"),
            vector[utf8(b"Fast Learner")],
            2,
            utf8(b"portfolio.com"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 7 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Urgent Position"),
            utf8(b"Need to fill ASAP"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Başvuru ve işe alma
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut job = ts::take_shared<Job>(&scenario);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        minihub::apply_to_job(
            &mut job,
            &user_profile,
            utf8(b"I can start immediately!"),
            utf8(b"cv.pdf"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_shared(user_profile);
        
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job = ts::take_shared<Job>(&scenario);
        let employer_cap = ts::take_from_sender<EmployerCap>(&scenario);
        
        minihub::hire_candidate(
            &mut job,
            &employer_cap,
            CANDIDATE1,
            0,
            ts::ctx(&mut scenario)
        );
        
        // İşe alındıktan sonra durumu kontrol et
        let (_, _, _, _, _, is_active, hired, _) = minihub::get_job_info(&job);
        
        assert!(!is_active, 0); // Artık aktif değil
        assert!(option::is_some(&hired), 1);
        assert!(*option::borrow(&hired) == CANDIDATE1, 2);
        assert!(minihub::is_job_filled(&job), 3);
        
        ts::return_shared(job);
        ts::return_to_sender(&scenario, employer_cap);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_application_count_increments() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // Profiller oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Popular Company"),
            utf8(b"Everyone wants to work here"),
            utf8(b"logo.png"),
            utf8(b"popular.com"),
            utf8(b"Tech"),
            500,
            2005,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Dream Job"),
            utf8(b"Best position ever"),
            option::some(200000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // İlk başta 0 başvuru
        ts::next_tx(&mut scenario, ADMIN);
        let job = ts::take_shared<Job>(&scenario);
        assert!(minihub::get_application_count(&job) == 0, 0);
        ts::return_shared(job);
        
        // 5 aday başvursun
        let candidates = vector[CANDIDATE1, CANDIDATE2, CANDIDATE3, @0xC4, @0xC5];
        let mut i = 0;
        while (i < 5) {
            let candidate = *vector::borrow(&candidates, i);
            
            ts::next_tx(&mut scenario, candidate);
            let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
            
            minihub::create_user_profile(
                &mut user_registry,
                utf8(b"Candidate"),
                utf8(b"Bio"),
                utf8(b"avatar.jpg"),
                vector[utf8(b"Skill")],
                i + 1,
                utf8(b"portfolio.com"),
                &clock,
                ts::ctx(&mut scenario)
            );
            
            ts::return_shared(user_registry);
            
            ts::next_tx(&mut scenario, candidate);
            let mut job = ts::take_shared<Job>(&scenario);
            let user_profile = ts::take_shared<UserProfile>(&scenario);
            
            minihub::apply_to_job(
                &mut job,
                &user_profile,
                utf8(b"Please hire me!"),
                utf8(b"cv.pdf"),
                &clock,
                ts::ctx(&mut scenario)
            );
            
            // Her başvuru sonrası sayıyı kontrol et
            assert!(minihub::get_application_count(&job) == i + 1, i + 1);
            
            ts::return_shared(job);
            ts::return_shared(user_profile);
            i = i + 1;
        };
        
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_employer_can_post_multiple_jobs() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Growing Startup"),
            utf8(b"Expanding team"),
            utf8(b"logo.png"),
            utf8(b"growing.com"),
            utf8(b"Tech"),
            15,
            2022,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Aynı işveren 5 farklı ilan açsın
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        let job_titles = vector[
            utf8(b"Frontend Developer"),
            utf8(b"Backend Developer"),
            utf8(b"DevOps Engineer"),
            utf8(b"Product Manager"),
            utf8(b"UX Designer")
        ];
        
        let mut i = 0;
        while (i < 5) {
            let title = *vector::borrow(&job_titles, i);
            
            minihub::post_job(
                &mut job_board,
                &employer_profile,
                title,
                utf8(b"Great opportunity"),
                option::some(100000 + (i * 10000)),
                deadline,
                ts::ctx(&mut scenario)
            );
            
            i = i + 1;
        };
        
        assert!(minihub::get_total_jobs(&job_board) == 5, 0);
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    #[expected_failure(abort_code = 3)]
    fun test_cannot_hire_without_application() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // Profil oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Company"),
            utf8(b"Desc"),
            utf8(b"logo.png"),
            utf8(b"site.com"),
            utf8(b"Tech"),
            10,
            2020,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // İş ilanı oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 30 * 24 * 60 * 60 * 1000;
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Developer"),
            utf8(b"Desc"),
            option::some(100000),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // Başvuru olmadan işe almaya çalış (başarısız olmalı)
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job = ts::take_shared<Job>(&scenario);
        let employer_cap = ts::take_from_sender<EmployerCap>(&scenario);
        
        minihub::hire_candidate(
            &mut job,
            &employer_cap,
            CANDIDATE1,
            0,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job);
        ts::return_to_sender(&scenario, employer_cap);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_zero_experience_profile() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // 0 yıl tecrübe ile profil oluştur (entry-level için)
        ts::next_tx(&mut scenario, CANDIDATE1);
        let mut user_registry = ts::take_shared<UserRegistry>(&scenario);
        
        minihub::create_user_profile(
            &mut user_registry,
            utf8(b"Fresh Graduate"),
            utf8(b"Just graduated, eager to learn"),
            utf8(b"fresh.jpg"),
            vector[utf8(b"JavaScript"), utf8(b"React")],
            0, // 0 yıl tecrübe
            utf8(b"github.com/fresh"),
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(user_registry);
        
        // Profili kontrol et
        ts::next_tx(&mut scenario, CANDIDATE1);
        let user_profile = ts::take_shared<UserProfile>(&scenario);
        
        let (_, name, _, _, _, exp, _, _, _) = 
            minihub::get_user_profile_info(&user_profile);
        
        assert!(name == utf8(b"Fresh Graduate"), 0);
        assert!(exp == 0, 1);
        
        ts::return_shared(user_profile);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
    
    #[test]
    fun test_high_salary_job() {
        let mut scenario = ts::begin(ADMIN);
        setup_test(&mut scenario);
        
        let clock = create_clock(&mut scenario);
        
        // İşveren profili oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut employer_registry = ts::take_shared<EmployerRegistry>(&scenario);
        
        minihub::create_employer_profile(
            &mut employer_registry,
            utf8(b"Big Tech Corp"),
            utf8(b"FAANG company"),
            utf8(b"logo.png"),
            utf8(b"bigtech.com"),
            utf8(b"Technology"),
            10000,
            1998,
            &clock,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(employer_registry);
        
        // Yüksek maaşlı ilan oluştur
        ts::next_tx(&mut scenario, EMPLOYER1);
        let mut job_board = ts::take_shared<JobBoard>(&scenario);
        let employer_profile = ts::take_shared<EmployerProfile>(&scenario);
        
        let deadline = clock::timestamp_ms(&clock) + 90 * 24 * 60 * 60 * 1000;
        let high_salary = 500000u64; // $500k
        
        minihub::post_job(
            &mut job_board,
            &employer_profile,
            utf8(b"Principal Engineer"),
            utf8(b"Lead our architecture team"),
            option::some(high_salary),
            deadline,
            ts::ctx(&mut scenario)
        );
        
        ts::return_shared(job_board);
        ts::return_shared(employer_profile);
        
        // İlanı kontrol et
        ts::next_tx(&mut scenario, ADMIN);
        let job = ts::take_shared<Job>(&scenario);
        
        let (_, _, title, _, salary, _, _, _) = minihub::get_job_info(&job);
        
        assert!(title == utf8(b"Principal Engineer"), 0);
        assert!(option::is_some(&salary), 1);
        assert!(*option::borrow(&salary) == high_salary, 2);
        
        ts::return_shared(job);
        clock::destroy_for_testing(clock);
        ts::end(scenario);
    }
}